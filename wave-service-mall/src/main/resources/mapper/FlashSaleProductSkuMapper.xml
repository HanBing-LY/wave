<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.langchao.waveservicemall.mapper.FlashSaleProductSkuMapper">
    <resultMap id="BaseResultMap" type="com.langchao.waveservicemall.pojo.FlashSaleProductSku">
            <id column="id" jdbcType="INTEGER" property="id"/>
            <result column="flash_sale_id" jdbcType="INTEGER" property="flashSaleId"/>
            <result column="product_sku_id" jdbcType="INTEGER" property="productSkuId"/>
            <result column="flash_sale_product_id" jdbcType="INTEGER" property="flashSaleProductId"/>
            <result column="price" jdbcType="DOUBLE" property="price"/>
    </resultMap>
    <delete id="deleteByProductSkuIds">
        delete from flash_sale_product_sku where id in
        <foreach collection="flashSaleProductIds" open="(" separator="," close=")" item="id" index="i">
            #{id}
        </foreach>
    </delete>
    <select id="getFlashSaleProduckStock" resultType="java.lang.Integer">
        select SUM(t_view.stock) from
         (SELECT ps.* FROM flash_sale_product_sku fsps
            INNER JOIN product_sku ps ON ps.id = fsps.product_sku_id
            INNER JOIN product_info pi ON pi.id = ps.product_id
        WHERE product_id = #{productId}) AS t_view
    </select>
    <select id="list" resultMap="listResultMap">
        SELECT
        product_sku.id productSkuId,
        product_info.id productId,
        product_info.product_name productName,
        product_info.product_icon productIcon,
        flash_sale_product_sku.price flashSalePrice,
        flash_sale_product_sku.id flashSaleProductSkuId,
        product_sku.stock,
        column_nature.nature_name,
        nature_value.value_desc
        FROM
        flash_sale_product_sku,
        product_sku,
        product_info,
        product_sku_nature,
        column_nature,
        nature_value
        WHERE
        flash_sale_product_sku.product_sku_id = product_sku.id
        AND product_sku.product_id = product_info.id
        AND flash_sale_product_sku.product_sku_id = product_sku_nature.product_sku_id
        AND product_sku_nature.nature_value_id = nature_value.id
        AND product_sku_nature.column_nature_id = column_nature_id
        AND column_nature.id = nature_value.nature_id
        <if test="flashSaleProductId != null ">
            and flash_sale_product_sku.flash_sale_product_id = #{flashSaleProductId}
        </if>
    </select>
    <resultMap id="listResultMap" type="com.langchao.waveservicemall.pojo.vo.FlashSaleProductSkuVo">
        <id column="flashSaleProductSkuId" property="flashSaleProductSkuId"/>
        <result column="productSkuId" property="productSkuId"/>
        <result column="productName" property="productName"/>
        <result column="productIcon" property="productIcon"/>
        <result column="stock" property="stock"/>
        <result column="productId" property="productId"/>
        <result column="flashSalePrice" property="flashSalePrice"/>
        <collection property="natureName" ofType="java.lang.String">
            <result column="nature_name" />
        </collection>
        <collection property="natureValueName" ofType="java.lang.String">
            <result column="value_desc" />
        </collection>
    </resultMap>
    <select id="selectByFlashSaleIds" resultMap="BaseResultMap">
        select * from flash_sale_product_sku where flash_sale_id IN
        <foreach collection="flashSaleIds" index="i" item="flashSaleIds" open="(" separator="," close=")" >
            #{flashSaleId}
        </foreach>
    </select>
    <!--<cache type="com.chemguan.business.core.util.RedisCache"/>-->
</mapper>